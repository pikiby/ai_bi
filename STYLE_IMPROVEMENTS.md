# Улучшения системы стилей таблиц

## Внесенные изменения

### 1. Автоматический подбор контрастных цветов текста
- **Функция**: `_build_css_styles()`
- **Логика**: Анализ яркости фона и автоматический выбор темного/светлого текста
- **Результат**: Светлый фон → темный текст, темный фон → светлый текст

### 2. Полупрозрачные цвета по умолчанию
- **Стандартные стили**: `rgba(240, 240, 240, 0.8)` вместо `#f0f0f0`
- **Промпт для бота**: Обновлены примеры с `rgba()` форматом
- **Результат**: Все цветовые выделения полупрозрачные

### 3. Улучшенная генерация стилей ботом
- **Промпт**: Добавлены примеры с `rgba()` и инструкции по прозрачности
- **Правила**: Всегда использовать `rgba()` с прозрачностью 0.5-0.9
- **Автоматика**: Цвета текста подбираются автоматически

## Технические детали

### Алгоритм контрастности
```python
def get_contrast_color(bg_color):
    # Вычисление яркости: (R*299 + G*587 + B*114) / 1000
    brightness = (r * 299 + g * 587 + b * 114) / 1000
    return "#000000" if brightness > 128 else "#ffffff"
```

### Поддерживаемые форматы
- `rgba(r, g, b, alpha)` - основной формат
- `#hex` - с автоматическим анализом яркости
- `transparent` - прозрачный фон

### Примеры использования
```python
# Полупрозрачные стили
table_style = {
    "header_fill_color": "rgba(255, 0, 0, 0.7)",
    "cells_fill_color": "rgba(173, 216, 230, 0.6)",
    "align": "center"
}
```

### 4. Светло-серые разделители
- **Границы таблицы**: `rgba(221, 221, 221, 0.6)` вместо `#ddd`
- **Границы ячеек**: Полупрозрачные светло-серые
- **Контейнер**: Единый стиль границ

### 5. Темный шрифт при наведении
- **Hover эффект**: При наведении шрифт становится темным (`#000000`)
- **Подсветка**: Полупрозрачный фон при наведении
- **Контраст**: Улучшенная читаемость при выделении

### 6. Умное выравнивание столбцов
- **Первый столбец**: Всегда по левому краю (названия, категории)
- **Остальные столбцы**: По правому краю (числа, даты, метрики)
- **CSS селекторы**: `:first-child` и `:not(:first-child)`
- **Промпт**: Обновлен с правилами выравнивания

### 7. Чередующиеся строки и исправление ошибок
- **Полосатые таблицы**: Поддержка `"striped": True` для чередующихся строк
- **Исправлена ошибка**: Добавлены недостающие функции (`range`, `len`, `min`, `max` и др.)
- **CSS класс**: `.striped` для активации полосатых строк
- **Цвет полос**: Полупрозрачный синий `rgba(173, 216, 230, 0.3)`

### 8. Подсветка экстремальных значений
- **Максимальные значения**: `"highlight_max": True` - красная подсветка
- **Минимальные значения**: `"highlight_min": True` - зеленая подсветка
- **CSS классы**: `.highlight-max` и `.highlight-min`
- **Цвета**: Полупрозрачные красный/зеленый с контрастным текстом
- **Функции**: Добавлены `col()` и `has_col()` для работы с колонками

### 9. Условное форматирование ячеек
- **Выделение по значению**: `"cell_rules": [{"value": "Краснодар", "color": "blue"}]`
- **Выделение по колонке**: `{"value": "100", "color": "green", "column": "amount"}`
- **Изменение цвета текста**: `{"value": "Краснодар", "color": "red", "text_color": "white"}`
- **Доступные цвета фона**: blue, red, green, yellow, orange, purple
- **Доступные цвета текста**: white, black, red, blue, green, yellow, orange, purple
- **CSS классы**: `.cell-blue`, `.cell-red`, `.text-white`, `.text-black` и др.
- **Функция**: `_apply_cell_formatting()` для применения правил к HTML

## Результат
- ✅ Контрастные цвета текста автоматически
- ✅ Полупрозрачные выделения по умолчанию  
- ✅ Бот генерирует правильные `rgba()` цвета
- ✅ Светло-серые разделители
- ✅ Темный шрифт при наведении
- ✅ Умное выравнивание столбцов
- ✅ Чередующиеся строки (полосатые таблицы)
- ✅ Подсветка максимальных/минимальных значений
- ✅ Условное форматирование конкретных ячеек
- ✅ Изменение цвета текста в ячейках
- ✅ Исправлены ошибки с `range`, `col` и другими функциями
- ✅ Улучшенная читаемость таблиц
